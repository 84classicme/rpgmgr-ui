<mat-stepper orientation="vertical" [linear]="isLinear" #stepper>
    <mat-step [stepControl]="raceFG"  state="phone">
        <div class="step-container-window">
            <div class="step-main-window">
                <form [formGroup]="raceFG">
                <ng-template matStepLabel>Choose your race</ng-template>
                <mat-form-field appearance="fill">
                    <mat-label>Race</mat-label>
                    <mat-select formControlName="race" 
                                class="form-control" 
                                [(value)]="selectedRace" 
                                (selectionChange)="getRaceDetails($event)" 
                                required>
                        <mat-option *ngFor="let race of races" [value]="race">{{ race.name }}</mat-option>
                    </mat-select>
                </mat-form-field>
                <div *ngIf="selectedRace.ability_bonus_options?.choose">
                    <div *ngFor="let in of counter(selectedRace.ability_bonus_options.choose); index as i"> 
                        <div formArrayName="raceAbilityOptions">                           
                            <mat-form-field appearance="fill">
                                <mat-label>Ability Bonus {{ i + 1 }}</mat-label>
                                <mat-select [formControlName]="i"  class="form-control">
                                    <mat-option *ngFor="let abbonus of selectedRace.ability_bonus_options.from" [value]="abbonus">
                                        +{{ abbonus.bonus }} {{ abbonus.ability_score.name }}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div> 
                    </div>                                            
                </div>
                <div *ngIf="selectedRace.starting_proficiency_options?.choose">
                    <div *ngFor="let in of counter(selectedRace.starting_proficiency_options.choose); index as i"> 
                        <div formArrayName="raceSkillOptions">                           
                            <mat-form-field appearance="fill">
                                <mat-label>Skill Choice</mat-label>
                                <mat-select [formControlName]="i"  
                                            class="form-control"  
                                            [required]="selectedRace.starting_proficiency_options.choose > 0">
                                    <mat-option *ngFor="let profoption of selectedRace.starting_proficiency_options.from" [value]="profoption.name | stripSkill" >
                                        {{ profoption.name | stripSkill }}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div> 
                    </div>                                             
                </div>
                <div *ngIf="selectedRace.subraces.length > 0 ? true : false">
                    <div>Choose a subrace:</div>                     
                    <mat-form-field appearance="fill">
                        <mat-label>Subrace</mat-label>
                        <mat-select formControlName="subrace" 
                                    class="form-control" 
                                    (selectionChange)="clearSubraceErrors()" 
                                    [(value)]="selectedSubrace"  
                                    [required]="(subraces$ | async) != null">
                            <mat-option *ngFor="let sub of subraces$ | async" [value]="sub">
                                {{ sub.name }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>                                         
                </div>

                <div *ngIf="selectedSubrace.language_options != null && selectedSubrace.language_options.from.length > 0">                
                    <mat-form-field appearance="fill">
                        <mat-label>Language Choice</mat-label>
                        <mat-select formControlName="subraceLanguage"  
                                    class="form-control"  
                                    [required]="selectedSubrace.language_options != null && selectedSubrace.language_options.from.length > 0">
                            <mat-option *ngFor="let language of selectedSubrace?.language_options?.from" [value]="language.name">
                                {{ language.name }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>      
                </div>
                <!-- <div *ngIf="raceFG.errors?.['required']">
                    Race is required.
                </div>
                <div *ngIf="selectedSubrace.errors?.['required']">
                    Subrace is required.
                </div> -->
<!-- 
                <mat-error *ngIf="raceFG.controls['race'].hasError('required') && raceFG.controls['race'].pristine">
                    Race is required.
                </mat-error>
                <mat-error *ngIf="raceFG.controls['raceSkillOptions'].hasError('required') && raceFG.controls['raceSkillOptions'].pristine">
                    Race skill option is required.
                </mat-error>
                <mat-error *ngIf="raceFG.controls['subrace'].hasError('required') && raceFG.controls['subrace'].pristine">
                    Subrace is required.
                </mat-error>
                <mat-error *ngIf="raceFG.controls['subraceLanguage'].hasError('required') && raceFG.controls['subraceLanguage'].pristine">
                    Subrace language option is required.
                </mat-error> -->
                <div>
                    <button mat-button matStepperNext (click)="saveRace()">Next</button>
                </div>
                </form>
            </div>
            <div class="step-detail-window">
                <div *ngIf="selectedRace.name">
                    <table class='step-table'>
                        <tr *ngIf="selectedRace?.ability_bonuses?.length">
                            <th class='step-table-row-header'>Ability Bonus{{ selectedRace.ability_bonuses.length > 1 ? 'es' : '' }}</th>
                            <td class='step-table-row'> 
                                <span *ngFor="let ability_bonus of selectedRace?.ability_bonuses; last as isLast">
                                    +{{ ability_bonus?.bonus }} {{ ability_bonus?.ability_score?.name }}{{ isLast ? '' : ', ' }}
                                </span>
                            </td>
                        </tr>
                        <tr *ngIf="selectedRace.ability_bonus_options">
                            <th class='step-table-row-header'>Ability Bonus Options</th>
                            <td class='step-table-row'> 
                                Choose {{ selectedRace.ability_bonus_options.choose}} from: 
                                <span *ngFor="let ability_bonus of selectedRace?.ability_bonus_options?.from; last as isLast">
                                    +{{ ability_bonus.bonus }} {{ ability_bonus.ability_score.name }}{{ isLast ? '' : ', ' }}
                                </span>
                            </td>
                        </tr>
                        <tr *ngIf="selectedSubrace?.ability_bonuses?.length">
                            <th class='step-table-row-header'>Subrace Bonus</th>
                            <td class='step-table-row'> 
                                <span *ngFor="let ability_bonus of selectedSubrace?.ability_bonuses">
                                    +{{ ability_bonus.bonus }} {{ ability_bonus.ability_score.name }}
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <th class='step-table-row-header'>Speed</th>
                            <td class='step-table-row'> {{ selectedRace.speed }}</td>
                        </tr>
                        <tr>
                            <th class='step-table-row-header'>Size</th>
                            <td class='step-table-row'> {{ selectedRace.size }}. {{ selectedRace.size_description }}</td>
                        </tr>
                        <tr *ngIf="selectedRace.traits.length">
                            <th class='step-table-row-header'>Traits</th>
                            <td class='step-table-row'> 
                                <span *ngFor="let trait of selectedRace.traits; last as isLast" 
                                        (click)="getTraitDetails(trait.index)">
                                    <span class="clickable">{{ trait.name }}</span>{{isLast?'':', '}}
                                </span>
                            </td>
                        </tr>
                        <tr *ngIf="selectedSubrace?.racial_traits?.length">
                            <th class='step-table-row-header'>Subrace Traits</th>
                            <td class='step-table-row'> 
                                <span *ngFor="let trait of selectedSubrace.racial_traits; last as isLast" 
                                        (click)="getTraitDetails(trait.index)">
                                    <span class="clickable">{{ trait.name }}</span>{{isLast?'':', '}}
                                </span>
                            </td>
                        </tr>
                        <tr *ngIf="selectedRace.starting_proficiencies.length">
                            <th class='step-table-row-header'>Starting Proficiencies</th>
                            <td class='step-table-row'> 
                                <span *ngFor="let proficiency of selectedRace.starting_proficiencies; last as isLast">
                                    <span *ngIf="proficiency.index.startsWith('skill')">
                                        <span class="clickable" (click)="getSkillDetails(proficiency.index.substring(6))">{{ proficiency.name | stripSkill }}</span>{{isLast?'':', '}}
                                    </span>
                                    <span *ngIf="!proficiency.index.startsWith('skill')">
                                        {{ proficiency.name | stripSkill }}{{ isLast ? '' : ', ' }}
                                    </span>                                
                                </span>
                            </td>
                        </tr>
                        <tr *ngIf="selectedRace.starting_proficiency_options">
                            <th class='step-table-row-header'>Skill Choices</th>
                            <td class='step-table-row'> 
                                <h5>Choice of {{ selectedRace.starting_proficiency_options.choose }}:</h5>
                                <span *ngFor="let option of selectedRace.starting_proficiency_options.from; last as isLast">
                                    {{ option.name | stripSkill }}{{ isLast ? '' : ', ' }}
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <th class='step-table-row-header'>Alignment</th>
                            <td class='step-table-row'> {{ selectedRace.alignment }}</td>
                        </tr>
                        <tr>
                            <th class='step-table-row-header'>Age</th>
                            <td class='step-table-row'> {{ selectedRace.age }}</td>
                        </tr>               
                        <tr>
                            <th class='step-table-row-header'>Languages</th>
                            <td class='step-table-row'> 
                                <span *ngFor="let language of selectedRace.languages; last as isLast" 
                                    (click)="getLanguageDetails(language.index)">
                                    <span class="clickable">{{ language.name }}</span>{{ isLast ? '' : ', ' }}
                                </span>
                            </td>
                        </tr>
                        <tr *ngIf="selectedSubrace?.language_options?.choose">
                            <th class='step-table-row-header'>Subrace Languages</th>
                            <td class='step-table-row'> 
                                <h5>Choice of {{ selectedSubrace.language_options.choose }}:</h5>
                                <span *ngFor="let language of selectedSubrace?.language_options?.from; last as isLast"
                                    (click)="getLanguageDetails(language.index)">
                                    <span class="clickable">{{ language.name }}</span>{{ isLast ? '' : ', ' }}
                                </span>
                            </td>
                        </tr>                        
                    </table>
                </div>
            </div>
        </div>
    </mat-step>
    <mat-step [stepControl]="classFG" label="Choose your class">
        <div class="step-container-window">
            <div class="step-main-window">
                <form [formGroup]="classFG">
                <mat-form-field appearance="fill">
                    <mat-label>Class</mat-label>
                    <mat-select formControlName="class" 
                                class="form-control" 
                                [(value)]="selectedClass" 
                                (selectionChange)="getClassDetails($event)" 
                                required>
                        <mat-option *ngFor="let class of classes" [value]="class">{{ class.name }}</mat-option>
                    </mat-select>
                </mat-form-field>
                <div *ngIf="classSkillOptions.length">
                    <div *ngFor="let option of selectedClass.proficiency_choices; index as idx">
                        <div *ngIf="option.type === 'skill'">                           
                            <div>Choose {{ option.choose }} {{ option.type | titlecase }}{{ option.choose > 1 ? 's' : '' }}:</div>
                            <div *ngFor="let in of counter(option.choose); index as i"> 
                                <div formArrayName="classSkillOptions">                           
                                    <mat-form-field appearance="fill">
                                        <mat-label>{{ option.type | titlecase }} {{i+1}}</mat-label>
                                        <mat-select [formControlName]="i"  
                                                    class="form-control"
                                                    [required]="selectedClass.proficiency_choices.length > 0">
                                            <mat-option *ngFor="let profoption of option.from" [value]="profoption.name | stripSkill">
                                                {{ profoption.name | stripSkill }} 
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </div>
                            </div>                                             
                        </div>
                    </div>
                </div>
                <div *ngIf="classToolOptions.length">
                    <div *ngFor="let option of selectedClass.proficiency_choices; index as idx">
                        <div *ngIf="option.type === 'tool'">                           
                            <div>Choose {{ option.choose }} {{ option.type | titlecase }}{{ option.choose > 1 ? 's' : '' }}:</div>
                            <div *ngFor="let in of counter(option.choose); index as i"> 
                                <div formArrayName="classToolOptions">                           
                                    <mat-form-field appearance="fill">
                                        <mat-label>{{ option.type | titlecase }} {{i+1}}</mat-label>
                                        <mat-select [formControlName]="i"  class="form-control">
                                            <mat-option *ngFor="let profoption of option.from" [value]="profoption.name | stripSkill">
                                                {{ profoption.name | stripSkill }}
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </div>
                            </div>                                             
                        </div>
                        <div *ngIf="option.type === 'instrument'">                           
                            <div>Choose {{ option.choose }} {{ option.type | titlecase }}{{ option.choose > 1 ? 's' : '' }}:</div>
                            <div *ngFor="let in of counter(option.choose); index as i"> 
                                <div formArrayName="classToolOptions">                           
                                    <mat-form-field appearance="fill">
                                        <mat-label>{{ option.type | titlecase }} {{i+1}}</mat-label>
                                        <mat-select [formControlName]="i"  class="form-control">
                                            <mat-option *ngFor="let profoption of option.from" [value]="profoption.name | stripSkill">
                                                {{ profoption.name | stripSkill }}
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </div>
                            </div>                                             
                        </div>
                    </div>
                </div> 
                <div class="alert" *ngIf="classFG.errors?.['duplicateChoices']">
                    Select 2 different skills!.
                </div>
                <div>
                    <button mat-button matStepperPrevious>Back</button>
                    <button mat-button matStepperNext (click)="saveClass()">Next</button>
                </div>
                </form>
            </div>
            <div class="step-detail-window">
                <div *ngIf="selectedClass.hit_die">
                    <table class='step-table'>
                        <tr>
                            <th class='step-table-row-header'>Hit Die</th>
                            <td class='step-table-row'> {{ selectedClass.hit_die }}</td>
                        </tr>
                        <tr>
                            <th class='step-table-row-header'>Saving Throws</th>
                            <td class='step-table-row'> 
                                <span *ngFor="let save of selectedClass.saving_throws; last as isLast">
                                    {{ save.name }}{{ isLast ? '' : ', ' }}
                                </span>
                            </td>
                        </tr>
                        <tr *ngIf="selectedClass.proficiencies.length">
                            <th class='step-table-row-header'>Proficiencies</th>
                            <td class='step-table-row'> 
                                <span *ngFor="let proficiency of selectedClass.proficiencies; last as isLast">
                                    {{ proficiency.name }}{{ isLast ? '' : ', ' }}
                                </span>
                            </td>
                        </tr>
                        <tr *ngIf="selectedClass.proficiency_choices.length">
                            <th class='step-table-row-header'>Skills</th>
                            <td class='step-table-row'> 
                                <span *ngFor="let choice of selectedClass.proficiency_choices">
                                    <h5>Choice of {{ choice.choose }}:</h5>
                                    <div *ngIf="choice.type === 'skill'">
                                        <span *ngFor="let option of choice.from; last as isLast" (click)="getSkillDetails(option.index)">
                                            <span class="clickable">{{ option.name | stripSkill }}</span>{{ isLast ? '' : ', ' }}
                                        </span>
                                    </div>
                                    <div *ngIf="choice.type === 'instrument' || choice.type === 'tool'">
                                        <span *ngFor="let option of choice.from; last as isLast">
                                            {{ option.name | stripSkill }}{{ isLast ? '' : ', ' }}
                                        </span>
                                    </div>
                                </span>
                            </td>
                        </tr>
                    </table>
                </div>           
                <div *ngIf="selectedClass.levels?.length">    
                    <table>
                        <tr>
                            <th class="level-table-header">Level</th>
                            <th class="level-table-header">Bonus</th>
                            <th class="level-table-header">Features</th>
                            <th *ngIf="selectedClass.levels[0].spellcasting && 
                                selectedClass.levels[0].spellcasting.cantrips_known != null" class="level-table-header">Cantrips</th>
                            <th *ngIf="selectedClass.levels[0].spellcasting &&
                                selectedClass.levels[0].spellcasting.spells_known != null" class="level-table-header">Spells</th>
                            <th *ngIf="selectedClass.levels[0].spellcasting &&
                                selectedClass.levels[0].spellcasting.spell_slots_level_1 != null" class="level-table-header">1st</th>
                            <th *ngIf="selectedClass.levels[0].spellcasting && 
                                selectedClass.levels[0].spellcasting.spell_slots_level_2 != null" class="level-table-header">2nd</th>
                            <th *ngIf="selectedClass.levels[0].spellcasting && 
                                selectedClass.levels[0].spellcasting.spell_slots_level_3 != null" class="level-table-header">3rd</th>
                            <th *ngIf="selectedClass.levels[0].spellcasting && 
                                selectedClass.levels[0].spellcasting.spell_slots_level_4 != null" class="level-table-header">4th</th>
                            <th *ngIf="selectedClass.levels[0].spellcasting && 
                                selectedClass.levels[0].spellcasting.spell_slots_level_5 != null" class="level-table-header">5th</th>
                            <th *ngIf="selectedClass.levels[0].spellcasting && 
                                selectedClass.levels[0].spellcasting.spell_slots_level_6 != null" class="level-table-header">6th</th>
                            <th *ngIf="selectedClass.levels[0].spellcasting && 
                                selectedClass.levels[0].spellcasting.spell_slots_level_7 != null" class="level-table-header">7th</th>
                            <th *ngIf="selectedClass.levels[0].spellcasting && 
                                selectedClass.levels[0].spellcasting.spell_slots_level_8 != null" class="level-table-header">8th</th>
                            <th *ngIf="selectedClass.levels[0].spellcasting && 
                                selectedClass.levels[0].spellcasting.spell_slots_level_9 != null" class="level-table-header">9th</th>
                        </tr>
                        <tr class="level-table-row" *ngFor="let level of selectedClass.levels; let even = even; let odd = odd" [ngClass]="{ odd: odd, even: even }">        
                            <td>
                                {{ level.level }}
                            </td>
                            <td>
                                +{{ level.prof_bonus }}
                            </td>
                            <td> 
                                <span *ngFor="let feature of level.features; last as isLast" 
                                    (click)="getFeatureDetails(feature.index)">
                                    <span class="clickable">{{ feature.name }}</span>{{ isLast ? '' : ', ' }}
                                </span>
                            </td>
                            <td *ngIf="level.spellcasting && level.spellcasting.cantrips_known != null"> 
                                {{ level.spellcasting?.cantrips_known }}
                            </td>  
                            <td *ngIf="level.spellcasting && level.spellcasting.spells_known != null">
                                {{ level.spellcasting.spells_known }}
                            </td>     
                            <td *ngIf="level.spellcasting && level.spellcasting.spell_slots_level_1 != null">
                                {{ level.spellcasting.spell_slots_level_1 }}
                            </td>
                            <td *ngIf="level.spellcasting && level.spellcasting.spell_slots_level_2 != null">
                                {{ level.spellcasting.spell_slots_level_2 }}
                            </td>
                            <td *ngIf="level.spellcasting && level.spellcasting.spell_slots_level_3 != null">
                                {{ level.spellcasting.spell_slots_level_3 }}
                            </td>
                            <td *ngIf="level.spellcasting && level.spellcasting.spell_slots_level_4 != null">
                                {{ level.spellcasting.spell_slots_level_4 }}
                            </td>
                            <td *ngIf="level.spellcasting && level.spellcasting.spell_slots_level_5 != null">
                                {{ level.spellcasting.spell_slots_level_5 }}
                            </td>
                            <td *ngIf="level.spellcasting && level.spellcasting.spell_slots_level_6 != null">
                                {{ level.spellcasting.spell_slots_level_6 }}
                            </td>
                            <td *ngIf="level.spellcasting && level.spellcasting.spell_slots_level_7 != null">
                                {{ level.spellcasting.spell_slots_level_7 }}
                            </td>
                            <td *ngIf="level.spellcasting && level.spellcasting.spell_slots_level_8 != null">
                                {{ level.spellcasting.spell_slots_level_8 }}
                            </td>
                            <td *ngIf="level.spellcasting && level.spellcasting.spell_slots_level_9 != null">
                                {{ level.spellcasting.spell_slots_level_9 }}
                            </td>                      
                        </tr>
                    </table>
                </div>   
            </div>        
        </div>
    </mat-step>
    <mat-step [stepControl]="abilitiesFG" label="Choose your ability scores">
        <form [formGroup]="abilitiesFG">
            <input matInput formControlName="str" hidden>
            <input matInput formControlName="dex" hidden>
            <input matInput formControlName="con" hidden>
            <input matInput formControlName="int" hidden>
            <input matInput formControlName="wis" hidden>
            <input matInput formControlName="cha" hidden>
            <div cdkDropListGroup>
                <div class="abilities-container">
                    <div class="abilities-pool">
                        <div class="abilities-header">Scores</div>
                        <div
                            cdkDropList
                            id="array"
                            class="abilities-array"
                            [cdkDropListData]="abilities"
                            (cdkDropListDropped)="addAbility($event)">
                            <div class="ability-box" *ngFor="let item of abilities" cdkDrag>{{item}}</div>
                        </div>
                    </div>
                    <div class="abilities-final">

                        <div class="abilities-header" (click)="getAbilityDetails('str')">Strength {{ abStr }}</div>                            
                        <div
                            cdkDropList
                            id="str"
                            class="abilities-score"
                            [cdkDropListData]="str"
                            (cdkDropListDropped)="addAbility($event)">
                            <div class="ability-box" *ngFor="let item of str" cdkDrag>{{item}}</div>
                        </div>

                        <div class="abilities-header" (click)="getAbilityDetails('dex')">Dexterity {{ abDex }}</div>                            
                        <div
                            cdkDropList
                            id="dex"
                            class="abilities-score"
                            [cdkDropListData]="dex"
                            (cdkDropListDropped)="addAbility($event)">
                            <div class="ability-box" *ngFor="let item of dex" cdkDrag>{{item}}</div>
                        </div>

                        <div class="abilities-header" (click)="getAbilityDetails('con')">Constituion {{ abCon }}</div>                            
                        <div
                            cdkDropList
                            id="con"
                            class="abilities-score"
                            [cdkDropListData]="con"
                            (cdkDropListDropped)="addAbility($event)">
                            <div class="ability-box" *ngFor="let item of con" cdkDrag>{{item}}</div>
                        </div>

                        <div class="abilities-header" (click)="getAbilityDetails('dex')">Intelligence {{ abInt }}</div>                            
                        <div
                            cdkDropList
                            id="int"
                            class="abilities-score"
                            [cdkDropListData]="int"
                            (cdkDropListDropped)="addAbility($event)">
                            <div class="ability-box" *ngFor="let item of int" cdkDrag>{{item}}</div>
                        </div>

                        <div class="abilities-header" (click)="getAbilityDetails('wis')">Wisdom {{ abWis }}</div>                            
                        <div
                            cdkDropList
                            id="wis"
                            class="abilities-score"
                            [cdkDropListData]="wis"
                            (cdkDropListDropped)="addAbility($event)">
                            <div class="ability-box" *ngFor="let item of wis" cdkDrag>{{item}}</div>
                        </div>

                        <div class="abilities-header" (click)="getAbilityDetails('cha')">Charisma  {{ abCha }}</div>                            
                        <div
                            cdkDropList
                            id="cha"
                            class="abilities-score"
                            [cdkDropListData]="cha"
                            (cdkDropListDropped)="addAbility($event)">
                            <div class="ability-box" *ngFor="let item of cha" cdkDrag>{{item}}</div>
                        </div>
                    </div>
                </div>
            </div>
            <div>
                <button mat-button matStepperPrevious>Back</button>
                <button mat-button matStepperNext (click)="saveAbilities()">Next</button>
            </div>  
        </form>
    </mat-step>     
    <mat-step [stepControl]="proficiencyFG" label="Choose your skills">
        <form [formGroup]="proficiencyFG">
            <h4>Background Skills and Proficiencies</h4>
            What did your charcater do before they started adventuring? Use the choices below to give your character a background of useful skills
            and proficiencies.
            <h5>First, choose 2 skills from the choices below. </h5>
            <mat-form-field appearance="fill">
                <mat-label>First Skill</mat-label>
                <mat-select formControlName="skill1" class="form-control" required>
                    <mat-option *ngFor="let skill of skills" [value]="skill.reference.name">{{ skill.reference.name }}</mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>Second Skill</mat-label>
                <mat-select formControlName="skill2" class="form-control" required>
                    <mat-option *ngFor="let skill of skills" [value]="skill.reference.name">{{ skill.reference.name }}</mat-option>
                </mat-select>
            </mat-form-field>
            <h5>Then, select 2 options from the following choices to give your character extra skills or languages. It's ok to choose 2 options from the same list.</h5>
            <mat-form-field appearance="fill">
                <mat-label>Languages</mat-label>
                <mat-select formControlName="languages" class="form-control" multiple>
                    <mat-option *ngFor="let language of languages" [value]="language.name">{{ language.name }}</mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>Artisan's Tools</mat-label>
                <mat-select formControlName="artisantools" class="form-control" multiple>
                    <mat-option *ngFor="let tool of tools" [value]="tool.name">{{ tool.name }}</mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>Other Tools</mat-label>
                <mat-select formControlName="othertools" class="form-control" multiple>
                    <mat-option *ngFor="let other of other_tools" [value]="other.name">{{ other.name }}</mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>Instruments</mat-label>
                <mat-select formControlName="instruments" class="form-control" multiple>
                    <mat-option *ngFor="let instrument of instruments" [value]="instrument.name">{{ instrument.name }}</mat-option>
                </mat-select>
            </mat-form-field>
            <div class="alert" *ngIf="proficiencyFG.errors?.['moreThan2Proficiencies']">
                You can only select 2 options from tools and languages.
            </div>
            <div>
                <button mat-button matStepperPrevious>Back</button>
                <button mat-button matStepperNext (click)="saveProficiencies()">Next</button>
            </div>
        </form>
    </mat-step>  
    <mat-step [stepControl]="descriptionFG" label="Describe your character">
        <form [formGroup]="descriptionFG">
            <mat-form-field appearance="fill">
                <mat-label>Name</mat-label>
                <input matInput placeholder="Name" formControlName="name">
            </mat-form-field>
            <h4>Appearance</h4>
            <mat-form-field appearance="fill">
                <mat-label>Height</mat-label>
                <input matInput placeholder="Height" formControlName="height">
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>Weight</mat-label>
                <input matInput placeholder="Weight" formControlName="weight">
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>Hair Color</mat-label>
                <input matInput placeholder="Height" formControlName="hair">
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>Eye Color</mat-label>
                <input matInput placeholder="Weight" formControlName="eyes">
            </mat-form-field>
            <h4>Outlook</h4>
            <mat-form-field appearance="fill">
                <mat-label>Alignment</mat-label>
                <mat-select formControlName="alignment" class="form-control" required>
                    <mat-option *ngFor="let alignment of alignments" [value]="alignment.name">{{ alignment.name }}</mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>Deity</mat-label>
                <input matInput placeholder="Deity" formControlName="deity">
            </mat-form-field>
            <div>
                <button mat-button matStepperPrevious>Back</button>
                <button mat-button matStepperNext (click)="saveDescription()">Next</button>
            </div>        
        </form>
    </mat-step>     
    <mat-step [stepControl]="equipmentFG" label="Equip your character">
        <form [formGroup]="equipmentFG">
            <div *ngIf="character.class.starting_equipment.length">
                Good news! Your {{ character.class.name }} starts with the following items: 
                <span *ngFor="let item of character.class.starting_equipment; last as isLast">
                    {{  isLast ? 'and ' : ''  }}{{ item.equipment.name }}{{  isLast ? '.' : ', '  }}
                </span>
            </div>
            <div *ngIf="character.class.starting_equipment_options.length">
                Choose from the options below to completely ready yourself {{ character.class.name }} for adventure, fame, glory, riches, etc, etc...
                <div formArrayName="eqOptions">
                    <div *ngFor="let option of character.class.starting_equipment_options; index as idx">
                        <table>
                            <tr>
                                <td>Option {{ idx + 1 }}:</td>
                                <td>
                                    <mat-button-toggle-group [formControlName]="idx" >
                                        <mat-button-toggle *ngFor="let itemoption of option?.from; last as isLast" [value]="itemoption.equipment?.name">
                                            {{ itemoption.equipment.name }}
                                        </mat-button-toggle>
                                    </mat-button-toggle-group>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>               
            <div>
                <button mat-button matStepperPrevious>Back</button>
                <button mat-button matStepperNext (click)="saveEquipment()">Next</button>
            </div>
        </form>
    </mat-step>
    <mat-step [stepControl]="confirmationFG" label="Confirm your choices">
        <form [formGroup]="confirmationFG">
            <table>
                <tr>
                    <td class='step-table-row-header'>Name</td>
                    <td class='step-table-row'> {{ character.name }}</td>
                </tr>
                <tr>
                    <td class='step-table-row-header'>Class</td>
                    <td class='step-table-row'> {{ character.class.name }}</td>
                </tr>
                <tr>
                    <td class='step-table-row-header'>Alignment</td>
                    <td class='step-table-row'> {{ character.alignment }}</td>
                </tr>
                <tr>
                    <td class='step-table-row-header'>Deity</td>
                    <td class='step-table-row'> {{ character.deity }}</td>
                </tr>
                <tr>
                    <td class='step-table-row-header'>Race</td>
                    <td class='step-table-row'> {{ character.race.name }}</td>
                </tr>
                <tr *ngIf="selectedRace.traits.length">
                    <td class='step-table-row-header'>Traits</td>
                    <td class='step-table-row'> 
                        <span *ngFor="let trait of selectedRace.traits; last as isLast">
                            {{ trait.name }}{{isLast?'':', '}}
                        </span>
                    </td>
                </tr>
                <tr *ngIf="selectedSubrace?.racial_traits?.length">
                    <td class='step-table-row-header'>Subrace Traits</td>
                    <td class='step-table-row'> 
                        <span *ngFor="let trait of selectedSubrace.racial_traits; last as isLast">
                            {{ trait.name }}{{isLast?'':', '}}
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class='step-table-row-header'>Strength</td>
                    <td class='step-table-row'> {{ character.str }}</td>
                </tr>
                <tr>
                    <td class='step-table-row-header'>Dexterity</td>
                    <td class='step-table-row'> {{ character.dex }}</td>
                </tr>
                <tr>
                    <td class='step-table-row-header'>Constituion</td>
                    <td class='step-table-row'> {{ character.con }}</td>
                </tr>
                <tr>
                    <td class='step-table-row-header'>Intelligence</td>
                    <td class='step-table-row'> {{ character.int }}</td>
                </tr>
                <tr>
                    <td class='step-table-row-header'>Wisdom</td>
                    <td class='step-table-row'> {{ character.wis }}</td>
                </tr>
                <tr>
                    <td class='step-table-row-header'>Charisma</td>
                    <td class='step-table-row'> {{ character.cha }}</td>
                </tr>
                <tr>
                    <td class='step-table-row-header'>Skills</td>
                    <td class='step-table-row'>            
                        <span *ngFor="let skill of character.skills; last as isLast">
                            {{ skill }}{{ isLast ? '' : ', ' }}
                        </span>
                    </td>
                </tr>
                <tr *ngIf="character.proficiencies.length">
                    <td class='step-table-row-header'>Proficiences</td>
                    <td class='step-table-row'> 
                        <div *ngFor="let proficiency of character.proficiencies; last as isLast">
                            {{ proficiency }}{{ isLast ? '' : ', ' }}
                        </div>                    
                    </td>
                </tr>
                <tr *ngIf="character.subraceLanguage || character.languages.length">
                    <td class='step-table-row-header'>Languages</td>
                    <td class='step-table-row'> 
                        <div *ngIf="character.subraceLanguage">{{ character.subraceLanguage }}</div>
                        <span *ngFor="let language of character.languages; last as isLast">
                            {{ language }}{{ isLast ? '' : ', ' }}
                        </span>
                    </td>
                </tr>
            </table>
            <div>
                <button mat-button matStepperPrevious>Back</button>
                <button mat-button matStepperNext>Confirm</button>
            </div>
        </form>
    </mat-step>
    <mat-step>
        <ng-template matStepLabel>Done</ng-template>
        <p>You are now done.</p>
        <div>
        <!-- <button mat-button matStepperPrevious>Back</button>
        <button mat-button (click)="stepper.reset()">Reset</button> -->
        </div>
    </mat-step>
</mat-stepper>
  