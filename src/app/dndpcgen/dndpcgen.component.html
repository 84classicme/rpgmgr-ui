<mat-stepper orientation="vertical" [linear]="isLinear" #stepper>
    <!-- <app-race-step (selectedRace)="saveRace  ($event)"></app-race-step> -->
    <mat-step [stepControl]="raceFG">
        <div class="step-container-window">
            <div class="step-main-window">
                <form [formGroup]="raceFG">
                <ng-template matStepLabel>Choose your race</ng-template>
                <mat-form-field appearance="fill">
                    <mat-label>Race</mat-label>
                    <mat-select formControlName="race" class="form-control" [(value)]="selectedRace" required>
                        <mat-option *ngFor="let race of races" [value]="race">{{ race.name }}</mat-option>
                    </mat-select>
                </mat-form-field>
                <div>
                    <button mat-button matStepperNext (click)="saveRace()">Next</button>
                </div>
                </form>
            </div>
            <div class="step-detail-window">
                <div *ngIf="selectedRace">
                    <table class='step-table'>
                        <tr>
                            <th class='step-table-row-header'>Speed</th>
                            <td class='table-row'> {{ selectedRace.speed }}</td>
                        </tr>
                        <tr>
                            <th class='step-table-row-header'>Alignment</th>
                            <td class='step-table-row'> {{ selectedRace.alignment }}</td>
                        </tr>
                        <tr>
                            <th class='step-table-row-header'>Age</th>
                            <td class='step-table-row'> {{ selectedRace.age }}</td>
                        </tr>
                        <tr>
                            <th class='step-table-row-header'>Size</th>
                            <td class='step-table-row'> {{ selectedRace.size }}. {{ selectedRace.size_description }}</td>
                        </tr>
                        <tr>
                            <th class='step-table-row-header'>Languages</th>

                            <td class='step-table-row'> {{ selectedRace.language_desc }} </td>
                        </tr>
                        <tr *ngIf="selectedRace.starting_proficiencies.length > 0">
                            <th class='step-table-row-header'>Starting Proficiencies</th>
                            <td class='step-table-row'> 
                                <div *ngFor="let proficiency of selectedRace.starting_proficiencies">
                                    {{ proficiency.name }}
                                </div>
                            </td>
                        </tr>
                        <tr *ngIf="selectedRace.traits.length > 0">
                            <th class='step-table-row-header'>Traits</th>
                            <td class='step-table-row'> 
                                <span *ngFor="let trait of selectedRace.traits">
                                    {{ trait.name }}
                                </span>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </mat-step>
    <mat-step [stepControl]="classFG" label="Choose your class">
        <div class="step-container-window">
            <div class="step-main-window">
                <form [formGroup]="classFG">
                <mat-form-field appearance="fill">
                    <mat-label>Class</mat-label>
                    <mat-select formControlName="class" class="form-control" [(value)]="selectedClass" (selectionChange)="getLevels($event)" required>
                        <mat-option *ngFor="let class of classes" [value]="class">{{ class.name }}</mat-option>
                    </mat-select>
                </mat-form-field>
                <div>
                    <button mat-button matStepperPrevious>Back</button>
                    <button mat-button matStepperNext (click)="saveClass()">Next</button>
                </div>
                </form>
            </div>
            <div class="step-detail-window">
                <div *ngIf="selectedClass.hit_die">
                    <table class='step-table'>
                        <tr>
                            <th class='step-table-row-header'>Hit Die</th>
                            <td class='step-table-row'> {{ selectedClass.hit_die }}</td>
                        </tr>
                        <tr>
                            <th class='step-table-row-header'>Saving Throws</th>
                            <td class='step-table-row'> 
                                <div *ngFor="let save of selectedClass.saving_throws">
                                    {{ save.name }}
                                </div>
                            </td>
                        </tr>
                        <tr *ngIf="selectedClass.proficiencies.length > 0">
                            <th class='step-table-row-header'>Proficiencies</th>
                            <td class='step-table-row'> 
                                <div *ngFor="let proficiency of selectedClass.proficiencies">
                                    {{ proficiency.name }}
                                </div>
                            </td>
                        </tr>
                        <tr *ngIf="selectedClass.proficiency_choices.length > 0">
                            <th class='step-table-row-header'>Skills</th>
                            <td class='step-table-row'> 
                                <div *ngFor="let choice of selectedClass.proficiency_choices">
                                    {{ choice.choose }} from the following:
                                    <div *ngFor="let option of choice.from">
                                        {{ option.name | stripSkill }}
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="step-detail-window" *ngIf="selectedClass.levels?.length">    
                <table>
                    <tr>
                        <th class="level-table-header">Level</th>
                        <th class="level-table-header">Bonus</th>
                        <th class="level-table-header">Features</th>
                        <th *ngIf="selectedClass.levels[0].spellcasting && 
                            selectedClass.levels[0].spellcasting.cantrips_known != null" class="level-table-header">Cantrips</th>
                        <th *ngIf="selectedClass.levels[0].spellcasting &&
                            selectedClass.levels[0].spellcasting.spells_known != null" class="level-table-header">Spells</th>
                        <th *ngIf="selectedClass.levels[0].spellcasting &&
                            selectedClass.levels[0].spellcasting.spell_slots_level_1 != null" class="level-table-header">1st</th>
                        <th *ngIf="selectedClass.levels[0].spellcasting && 
                            selectedClass.levels[0].spellcasting.spell_slots_level_2 != null" class="level-table-header">2nd</th>
                        <th *ngIf="selectedClass.levels[0].spellcasting && 
                            selectedClass.levels[0].spellcasting.spell_slots_level_3 != null" class="level-table-header">3rd</th>
                        <th *ngIf="selectedClass.levels[0].spellcasting && 
                            selectedClass.levels[0].spellcasting.spell_slots_level_4 != null" class="level-table-header">4th</th>
                        <th *ngIf="selectedClass.levels[0].spellcasting && 
                            selectedClass.levels[0].spellcasting.spell_slots_level_5 != null" class="level-table-header">5th</th>
                        <th *ngIf="selectedClass.levels[0].spellcasting && 
                            selectedClass.levels[0].spellcasting.spell_slots_level_6 != null" class="level-table-header">6th</th>
                        <th *ngIf="selectedClass.levels[0].spellcasting && 
                            selectedClass.levels[0].spellcasting.spell_slots_level_7 != null" class="level-table-header">7th</th>
                        <th *ngIf="selectedClass.levels[0].spellcasting && 
                            selectedClass.levels[0].spellcasting.spell_slots_level_8 != null" class="level-table-header">8th</th>
                        <th *ngIf="selectedClass.levels[0].spellcasting && 
                            selectedClass.levels[0].spellcasting.spell_slots_level_9 != null" class="level-table-header">9th</th>
                    </tr>
                    <tr *ngFor="let level of selectedClass.levels; let even = even; let odd = odd" [ngClass]="{ odd: odd, even: even }">        
                        <td>
                            {{ level.level }}
                        </td>
                        <td>{{ level.prof_bonus }}</td>
                        <td> 
                            <div *ngFor="let feature of level.features">
                                {{ feature.name  }}
                            </div>
                        </td>
                        <td *ngIf="level.spellcasting && level.spellcasting.cantrips_known != null"> 
                            {{ level.spellcasting?.cantrips_known }}
                        </td>  
                        <td *ngIf="level.spellcasting && level.spellcasting.spells_known != null">
                            {{ level.spellcasting.spells_known }}
                        </td>     
                        <td *ngIf="level.spellcasting && level.spellcasting.spell_slots_level_1 != null">
                            {{ level.spellcasting.spell_slots_level_1 }}
                        </td>
                        <td *ngIf="level.spellcasting && level.spellcasting.spell_slots_level_2 != null">
                            {{ level.spellcasting.spell_slots_level_2 }}
                        </td>
                        <td *ngIf="level.spellcasting && level.spellcasting.spell_slots_level_3 != null">
                            {{ level.spellcasting.spell_slots_level_3 }}
                        </td>
                        <td *ngIf="level.spellcasting && level.spellcasting.spell_slots_level_4 != null">
                            {{ level.spellcasting.spell_slots_level_4 }}
                        </td>
                        <td *ngIf="level.spellcasting && level.spellcasting.spell_slots_level_5 != null">
                            {{ level.spellcasting.spell_slots_level_5 }}
                        </td>
                        <td *ngIf="level.spellcasting && level.spellcasting.spell_slots_level_6 != null">
                            {{ level.spellcasting.spell_slots_level_6 }}
                        </td>
                        <td *ngIf="level.spellcasting && level.spellcasting.spell_slots_level_7 != null">
                            {{ level.spellcasting.spell_slots_level_7 }}
                        </td>
                        <td *ngIf="level.spellcasting && level.spellcasting.spell_slots_level_8 != null">
                            {{ level.spellcasting.spell_slots_level_8 }}
                        </td>
                        <td *ngIf="level.spellcasting && level.spellcasting.spell_slots_level_9 != null">
                            {{ level.spellcasting.spell_slots_level_9 }}
                        </td>                      
                    </tr>
                </table>
            </div>           
        </div>
    </mat-step>
    <mat-step [stepControl]="abilitiesFG" label="Determine your ability scores">
        <form [formGroup]="abilitiesFG">
            <input matInput formControlName="str" hidden>
            <input matInput formControlName="dex" hidden>
            <input matInput formControlName="con" hidden>
            <input matInput formControlName="int" hidden>
            <input matInput formControlName="wis" hidden>
            <input matInput formControlName="cha" hidden>
            <div cdkDropListGroup>
                <div class="ability-array-container">
                    <div class="ability-container-header">Scores</div> 
                    <div class="ability-list-container">
                        <div
                            cdkDropList
                            id="array"
                            class="ability-array-list"
                            [cdkDropListData]="abilities"
                            (cdkDropListDropped)="addAbility($event)">
                            <div class="ability-box" *ngFor="let item of abilities" cdkDrag>{{item}}</div>
                        </div>
                    </div>
                </div>
                <div class="ability-scores-container">
                    <div class="ability-container">
                        <div class="ability-header">Strength</div>
                        <div class="ability-list-container">
                            <div
                                cdkDropList
                                id="str"
                                class="ability-list"
                                [cdkDropListData]="str"
                                (cdkDropListDropped)="addAbility($event)">
                                <div class="ability-box" *ngFor="let item of str" cdkDrag>{{item}}</div>
                            </div>
                        </div>
                    </div>
                    <div class="ability-container">
                        <div class="ability-header">Dexterity</div>
                        <div class="ability-list-container">
                            <div
                                cdkDropList
                                id="dex"
                                class="ability-list"
                                [cdkDropListData]="dex"
                                (cdkDropListDropped)="addAbility($event)">
                                <div class="ability-box" *ngFor="let item of dex" cdkDrag>{{item}}</div>
                            </div>
                        </div>
                    </div>    
                    <div class="ability-container">
                        <div class="ability-header">Constitution</div>
                        <div class="ability-list-container">
                            <div
                                cdkDropList
                                id="con"
                                class="ability-list"
                                [cdkDropListData]="con"
                                (cdkDropListDropped)="addAbility($event)">
                                <div class="ability-box" *ngFor="let item of con" cdkDrag>{{item}}</div>
                            </div>
                        </div>
                    </div>
                        <div class="ability-container">
                        <div class="ability-header">Intelligence</div>
                        <div class="ability-list-container">
                            <div
                                cdkDropList
                                id="int"
                                class="ability-list"
                                [cdkDropListData]="int"
                                (cdkDropListDropped)="addAbility($event)">
                                <div class="ability-box" *ngFor="let item of int" cdkDrag>{{item}}</div>
                            </div>
                        </div>
                    </div>
                    <div class="ability-container">
                        <div class="ability-header">Wisdom</div>
                        <div class="ability-list-container">
                            <div
                                cdkDropList
                                id="wis"
                                class="ability-list"
                                [cdkDropListData]="wis"
                                (cdkDropListDropped)="addAbility($event)">
                                <div class="ability-box" *ngFor="let item of wis" cdkDrag>{{item}}</div>
                            </div>
                        </div>
                    </div>
                    <div class="ability-container">
                        <div class="ability-header">Charisma</div>
                        <div class="ability-list-container">
                            <div
                                cdkDropList
                                id="cha"
                                class="ability-list"
                                [cdkDropListData]="cha"
                                (cdkDropListDropped)="addAbility($event)">
                                <div class="ability-box" *ngFor="let item of cha" cdkDrag>{{item}}</div>
                            </div> 
                        </div>
                    </div>  
                </div>              
            </div>
            <div>
                <button mat-button matStepperPrevious>Back</button>
                <button mat-button matStepperNext (click)="saveAbilities()">Next</button>
            </div>  
        </form>
    </mat-step>   
    <mat-step [stepControl]="descriptionFG" label="Describe your character">
        <form [formGroup]="descriptionFG">
            <h3>Appearance</h3>
            <mat-form-field appearance="fill">
                <mat-label>Height</mat-label>
                <input matInput placeholder="Height" formControlName="height">
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>Weight</mat-label>
                <input matInput placeholder="Weight" formControlName="weight">
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>Hair Color</mat-label>
                <input matInput placeholder="Height" formControlName="hair">
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>Eye Color</mat-label>
                <input matInput placeholder="Weight" formControlName="eyes">
            </mat-form-field>
            <h3>Outlook</h3>
            <mat-form-field appearance="fill">
                <mat-label>Deity</mat-label>
                <input matInput placeholder="Deity" formControlName="deity">
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>Alignment</mat-label>
                <mat-select formControlName="alignment" class="form-control" required>
                    <mat-option *ngFor="let alignment of alignments" [value]="alignment.name">{{ alignment.name }}</mat-option>
                </mat-select>
            </mat-form-field>
            <h3>Background</h3>
            <h4>Skills</h4>
            <mat-form-field appearance="fill">
                <mat-label>First Skill</mat-label>
                <mat-select formControlName="skill1" class="form-control" required>
                    <mat-option *ngFor="let skill of skills" [value]="skill.reference.name">{{ skill.reference.name }}</mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>Second Skill</mat-label>
                <mat-select formControlName="skill2" class="form-control" required>
                    <mat-option *ngFor="let skill of skills" [value]="skill.reference.name">{{ skill.reference.name }}</mat-option>
                </mat-select>
            </mat-form-field>
            <h4>Other Proficiences</h4>
            <h5>Use dropdowns below to give your character 2 extra skills or languages.</h5>
            <mat-form-field appearance="fill">
                <mat-label>Artisan's Tools</mat-label>
                <mat-select formControlName="artisantools" class="form-control" multiple>
                    <mat-option *ngFor="let tool of tools" [value]="tool.name">{{ tool.name }}</mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>Other Tools</mat-label>
                <mat-select formControlName="othertools" class="form-control" multiple>
                    <mat-option *ngFor="let other of others" [value]="other.name">{{ other.name }}</mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>Languages</mat-label>
                <mat-select formControlName="languages" class="form-control" multiple>
                    <mat-option *ngFor="let language of languages" [value]="language.name">{{ language.name }}</mat-option>
                </mat-select>
            </mat-form-field>
            <div>
                <button mat-button matStepperPrevious>Back</button>
                <button mat-button matStepperNext (click)="saveDescription()">Next</button>
            </div>
        </form>
    </mat-step>   
    <mat-step [stepControl]="equipmentFG" label="Equip your character">
        <form [formGroup]="equipmentFG">
            <div *ngIf="character.class.starting_equipment.length > 0">
                The {{ character.class.name }} starts with the following equipment:
                <ul *ngFor="let item of character.class.starting_equipment">
                    <li>{{ item.equipment.name }}</li>
                </ul>
            </div>
            <div *ngIf="character.class.starting_equipment_options.length > 0">
                <div formArrayName="eqOptions">
                    Choose from the following equipment options:
                    <div *ngFor="let option of character.class.starting_equipment_options; index as idx">
                        <div>Choose {{ option.choose }} items from the following {{ option.type }}</div>
                        <mat-button-toggle-group [formControlName]="idx" >
                            <mat-button-toggle *ngFor="let itemoption of option?.from" [value]="itemoption.equipment?.name">
                                {{itemoption.equipment.name}}
                            </mat-button-toggle>
                        </mat-button-toggle-group>
                    </div>
                </div>
            </div>    
            <div>
                <button mat-button matStepperPrevious>Back</button>
                <button mat-button matStepperNext (click)="saveEquipment()">Next</button>
            </div>
        </form>
    </mat-step>
    <mat-step [stepControl]="confirmationFG" label="Confirm you choices">
        <form [formGroup]="confirmationFG">
            <table>
                <tr>
                    <td>Race</td>
                    <td> {{ character.race.name }}</td>
                </tr>
                <tr>
                    <td>Class</td>
                    <td> {{ character.class.name }}</td>
                </tr>
                <tr>
                    <td>Strength</td>
                    <td> {{ character.str }}</td>
                </tr>
                <tr>
                    <td>Dexterity</td>
                    <td> {{ character.dex }}</td>
                </tr>
                <tr>
                    <td>Constituion</td>
                    <td> {{ character.con }}</td>
                </tr>
                <tr>
                    <td>Intelligence</td>
                    <td> {{ character.int }}</td>
                </tr>
                <tr>
                    <td>Wisdom</td>
                    <td> {{ character.wis }}</td>
                </tr>
                <tr>
                    <td>Charisma</td>
                    <td> {{ character.cha}}</td>
                </tr>
                <tr>
                    <td>Alignment</td>
                    <td> {{ character.alignment }}</td>
                </tr>
                <tr>
                    <td>Deity</td>
                    <td> {{ character.deity }}</td>
                </tr>
                <tr>
                    <td>Skills</td>
                    <td> {{ character.skill1 }}&nbsp;&nbsp;{{ character.skill2 }}</td>
                </tr>
                <tr *ngIf="character.proficiencies">
                    <td>Proficiences</td>
                    <td> 
                        <div *ngFor="let proficiency of character.proficiencies">
                            {{ proficiency }}
                        </div>
                    </td>
                </tr>
                <tr *ngIf="character.languages">
                    <td>Languages</td>
                    <td> 
                        <div *ngFor="let language of character.languages">
                            {{ language }}
                        </div>
                    </td>
                </tr>
            </table>
            <div>
                <button mat-button matStepperPrevious>Back</button>
                <button mat-button matStepperNext>Confirm</button>
            </div>
        </form>
    </mat-step>
    <mat-step>
        <ng-template matStepLabel>Done</ng-template>
        <p>You are now done.</p>
        <div>
        <!-- <button mat-button matStepperPrevious>Back</button>
        <button mat-button (click)="stepper.reset()">Reset</button> -->
        </div>
    </mat-step>
</mat-stepper>
  